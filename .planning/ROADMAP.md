# Roadmap: SemanticSchemas

## Milestones

- ✅ **v0.1.2 Page-Type Property Display** - Phases 1-2 (shipped 2026-01-19)
- ✅ **v0.2.0 Multi-Category Page Creation** - Phases 3-9 (completed 2026-02-03)

## Phases

<details>
<summary>✅ v0.1.2 Page-Type Property Display (Phases 1-2) - SHIPPED 2026-01-19</summary>

### Phase 1: Property Display Template
**Goal**: Create Template:Property/Page for rendering Page-type property values as wiki links
**Plans**: 2 plans

Plans:
- [x] 01-01: Template creation
- [x] 01-02: Extension config integration

### Phase 2: Smart Fallback Logic
**Goal**: Implement getRenderTemplate() fallback hierarchy in PropertyModel and DisplayStubGenerator
**Plans**: 1 plan

Plans:
- [x] 02-01: Fallback implementation

</details>

### ✅ v0.2.0 Multi-Category Page Creation (Completed 2026-02-03)

**Milestone Goal:** Enable users to create pages belonging to multiple categories with a single form, intelligently deduplicating shared properties.

#### Phase 3: Feature Branch + Bug Fix
**Goal**: Create feature branch and resolve required/optional property conflict across category inheritance
**Depends on**: Phase 2 (v0.1.2)
**Requirements**: WF-01, FIX-01, FIX-02, FIX-03, FIX-04, FIX-05, FIX-06
**Success Criteria** (what must be TRUE):
  1. All v0.2.0 work exists in a feature branch named `multi-category-page-creation`
  2. When a property is both required and optional across inheritance, it is promoted to required without errors
  3. When a subobject is both required and optional across inheritance, it is promoted to required without errors
  4. SchemaValidator warns (not errors) when property appears in both required and optional
  5. Existing schemas without conflicts continue working identically
**Plans**: 2 plans

Plans:
- [x] 03-01-PLAN.md -- Create feature branch, fix model constructor crash points, update tests
- [x] 03-02-PLAN.md -- Change SchemaValidator overlap from error to warning, update OntologyInspector

#### Phase 4: Conditional Templates
**Goal**: Wrap semantic template `#set` calls in `#if` conditions to prevent empty value overwrites in multi-category pages
**Depends on**: Phase 3
**Requirements**: TMPL-01, TMPL-02, TMPL-03
**Success Criteria** (what must be TRUE):
  1. All semantic templates generated by TemplateGenerator use conditional `#if` wrapper before `#set`
  2. Multi-value properties use `+sep` parameter instead of manual separators
  3. Existing single-category pages continue storing and displaying properties correctly after template changes
  4. When multiple category templates set the same property, non-empty value wins (no overwrite with empty)
**Plans**: 1 plan

Plans:
- [x] 04-01-PLAN.md -- Add #if guards and +sep to TemplateGenerator output, update tests

#### Phase 5: Property Resolution
**Goal**: Multi-category property resolver identifies shared properties and resolves conflicts across selected categories
**Depends on**: Phase 3
**Requirements**: RESO-01, RESO-02, RESO-03, RESO-04, RESO-05, RESO-06
**Success Criteria** (what must be TRUE):
  1. MultiCategoryResolver accepts multiple category names and returns resolved property list
  2. Shared properties (same name across categories) are identified and deduplicated in output
  3. Each resolved property indicates which category defines it (source attribution)
  4. Property ordering within each category follows C3 linearization precedence
  5. Conflicting property datatypes across categories are detected and reported as errors
  6. When a property is required in any selected category, resolver marks it as required
**Plans**: 1 plan

Plans:
- [x] 05-01-PLAN.md -- Create MultiCategoryResolver, ResolvedPropertySet, and unit tests

#### Phase 6: Composite Form Generation
**Goal**: Generate single PageForms form with multiple `{{{for template}}}` blocks for multi-category page creation
**Depends on**: Phase 4, Phase 5
**Requirements**: FORM-01, FORM-02, FORM-03, FORM-04, FORM-05
**Success Criteria** (what must be TRUE):
  1. CompositeFormGenerator produces valid PageForms markup with multiple `{{{for template}}}` blocks
  2. Shared properties appear once in first template section (subsequent sections handled by conditional `#set`)
  3. Each template section has clear label identifying which category it represents
  4. Generated form includes `[[Category:X]]` wikilinks for all selected categories
  5. Composite form is saved as wiki Form: page and accessible via Special:FormEdit
**Plans**: 1 plan

Plans:
- [x] 06-01-PLAN.md -- CompositeFormGenerator with TDD: refactor FormGenerator methods, create generator with shared property deduplication, comprehensive tests

#### Phase 7: API Endpoint
**Goal**: API endpoint providing multi-category property resolution data for UI preview
**Depends on**: Phase 5
**Requirements**: API-01, API-02, API-03
**Success Criteria** (what must be TRUE):
  1. API endpoint `action=semanticschemas-multicategory` accepts multiple category names
  2. API response includes shared properties, category-specific properties, and conflicts
  3. API is registered in extension.json and follows existing ApiBase pattern
  4. JavaScript clients can call API and receive property resolution data synchronously
**Plans**: 1 plan

Plans:
- [x] 07-01-PLAN.md -- Create ApiSemanticSchemasMultiCategory endpoint with MultiCategoryResolver delegation, registration, i18n, and unit tests

#### Phase 8: Create Page UI
**Goal**: New Special page (Special:CreateSemanticPage) with hierarchy tree selection and live property preview
**Depends on**: Phase 6, Phase 7
**Requirements**: UI-01, UI-02, UI-03, UI-04, UI-05, UI-06
**Success Criteria** (what must be TRUE):
  1. Users with edit permissions can access Special:CreateSemanticPage
  2. Collapsible hierarchy tree displays all categories with checkboxes for selection
  3. Checking/unchecking categories triggers AJAX preview showing merged/deduplicated properties
  4. Page name input field allows naming the new page
  5. Submitting form generates composite form and redirects to Special:FormEdit
  6. JavaScript module is registered via ResourceLoader and loads without errors
**Plans**: 3 plans

Plans:
- [x] 08-01-PLAN.md -- Enhance multi-category API with property datatypes and category target namespaces
- [x] 08-02-PLAN.md -- Create SpecialCreateSemanticPage PHP class with registration, HTML skeleton, and POST handler
- [x] 08-03-PLAN.md -- Build client-side JS module and CSS for interactive tree, preview, and submit flow

#### Phase 9: State Management Refactor
**Goal**: StateManager uses template-level hashing instead of page-level hashing for dirty detection
**Depends on**: Phase 4
**Requirements**: STATE-01, STATE-02, STATE-03
**Success Criteria** (what must be TRUE):
  1. StateManager tracks hash for each template independently (not page-level hash)
  2. Multi-category pages do not trigger false-positive dirty warnings when one category schema changes
  3. Existing single-category state tracking continues working after refactor
  4. State JSON structure correctly stores and retrieves template-level hashes
**Plans**: 2 plans

Plans:
- [x] 09-01-PLAN.md -- Add templateHashes infrastructure to StateManager + PageHashComputer, unit tests
- [x] 09-02-PLAN.md -- Wire template hashing into generation flow, validation, and maintenance script

## Progress

**Execution Order:**
Phases execute in numeric order: 3 -> 4 -> 5 -> 6 -> 7 -> 8 -> 9

| Phase | Milestone | Plans Complete | Status | Completed |
|-------|-----------|----------------|--------|-----------|
| 1. Property Display Template | v0.1.2 | 2/2 | Complete | 2026-01-19 |
| 2. Smart Fallback Logic | v0.1.2 | 1/1 | Complete | 2026-01-19 |
| 3. Feature Branch + Bug Fix | v0.2.0 | 2/2 | Complete | 2026-02-02 |
| 4. Conditional Templates | v0.2.0 | 1/1 | Complete | 2026-02-02 |
| 5. Property Resolution | v0.2.0 | 1/1 | Complete | 2026-02-02 |
| 6. Composite Form Generation | v0.2.0 | 1/1 | Complete | 2026-02-02 |
| 7. API Endpoint | v0.2.0 | 1/1 | Complete | 2026-02-02 |
| 8. Create Page UI | v0.2.0 | 3/3 | Complete | 2026-02-03 |
| 9. State Management Refactor | v0.2.0 | 2/2 | Complete | 2026-02-03 |
