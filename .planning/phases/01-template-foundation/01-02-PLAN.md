---
phase: 01-template-foundation
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - resources/extension-config.json
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Template:Property/Page uses [[:@@item@@]] with leading colon for namespace-safe links"
    - "Namespaced page values (e.g., Property:PageA) link to correct destination"
    - "Non-namespaced page values continue to work correctly"
  artifacts:
    - path: "resources/extension-config.json"
      provides: "Property/Page template with leading colon in wikilink syntax"
      contains: "[[:@@item@@]]"
---

<objective>
Fix namespace handling bug in Template:Property/Page.

**Problem:** Namespaced page values (e.g., "Property:PageA") render links that go to the wrong destination ("PageA" instead of "Property:PageA").

**Root Cause:** Template uses `[[@@item@@]]` which relies on MediaWiki namespace recognition at parse time. Extension namespaces may not be recognized in template context.

**Fix:** Add leading colon to wikilink syntax: `[[@@item@@]]` → `[[:@@item@@]]`

**Why this works:** The leading colon tells MediaWiki to skip namespace/interwiki prefix scanning and treat the entire string as a direct page reference. This is the standard MediaWiki pattern for linking to special namespaces.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/01-template-foundation/01-UAT.md
@.planning/debug/namespace-page-link-bug.md
@resources/extension-config.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add leading colon to Property/Page template wikilink</name>
  <files>resources/extension-config.json</files>
  <action>
Edit the Property/Page template content in extension-config.json.

Change from:
```json
"content": "<includeonly>{{#if:{{{value|}}}|{{#arraymap:{{{value|}}}|,|@@item@@|[[@@item@@]]|,&#32;}}|}}</includeonly>"
```

To:
```json
"content": "<includeonly>{{#if:{{{value|}}}|{{#arraymap:{{{value|}}}|,|@@item@@|[[:@@item@@]]|,&#32;}}|}}</includeonly>"
```

The only change is `[[@@item@@]]` → `[[:@@item@@]]` (adding leading colon).
  </action>
  <verify>
Run: `grep -o '\[\[:@@item@@\]\]' resources/extension-config.json`
Should output: `[[:@@item@@]]`

Run: `python3 -c "import json; json.load(open('resources/extension-config.json'))"`
Should exit 0 (valid JSON).
  </verify>
  <done>
- Property/Page template content uses `[[:@@item@@]]` with leading colon
- JSON remains valid
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify fix in Docker test environment</name>
  <files></files>
  <action>
1. Reinstall extension config to update the template:
   ```bash
   docker compose exec wiki php maintenance/run.php /var/www/html/extensions/SemanticSchemas/maintenance/installConfig.php
   ```

2. Purge template cache:
   ```bash
   curl -s "http://localhost:8889/api.php?action=purge&titles=Template:Property/Page&format=json"
   ```

3. Test namespaced value:
   ```bash
   curl -s "http://localhost:8889/api.php?action=parse&text={{Property/Page|value=Property:Has_type}}&contentmodel=wikitext&format=json" | python3 -c "import sys,json; print(json.load(sys.stdin)['parse']['text']['*'])"
   ```
   Expected: Link href should contain "Property:Has_type", not just "Has_type".

4. Test non-namespaced value (regression check):
   ```bash
   curl -s "http://localhost:8889/api.php?action=parse&text={{Property/Page|value=Person}}&contentmodel=wikitext&format=json" | python3 -c "import sys,json; print(json.load(sys.stdin)['parse']['text']['*'])"
   ```
   Expected: Link href should contain "Person".

5. Test multi-value with mixed namespaces:
   ```bash
   curl -s "http://localhost:8889/api.php?action=parse&text={{Property/Page|value=Person, Property:Has_type, Category:People}}&contentmodel=wikitext&format=json" | python3 -c "import sys,json; print(json.load(sys.stdin)['parse']['text']['*'])"
   ```
   Expected: Three separate links, each to correct destination.
  </action>
  <verify>
1. Namespaced link (Property:Has_type) goes to Property namespace
2. Non-namespaced link (Person) still works correctly
3. Mixed multi-value works correctly
  </verify>
  <done>
- Namespaced page values link to correct destination
- Non-namespaced values unchanged (no regression)
- Multi-value with mixed namespaces works
  </done>
</task>

</tasks>

<verification>
After both tasks complete, the original UAT issue should be resolved:
- "Property:PageA" renders as link to Property:PageA (correct destination)
- Link display may still show "PageA" (this is expected MediaWiki behavior for namespaced links)
- Non-namespaced pages continue to work
</verification>

<success_criteria>
- resources/extension-config.json contains `[[:@@item@@]]` in Property/Page template
- Namespaced page values link to correct destination
- Non-namespaced page values continue to work (no regression)
- UAT gap closed
</success_criteria>

<output>
After completion, create `.planning/phases/01-template-foundation/01-02-SUMMARY.md`
</output>
