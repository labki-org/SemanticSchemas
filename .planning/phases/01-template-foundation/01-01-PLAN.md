---
phase: 01-template-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - resources/extension-config.json
autonomous: true

must_haves:
  truths:
    - "Template:Property/Page is defined in extension-config.json"
    - "Template handles empty values by producing no output"
    - "Template renders single value as clickable wiki link"
    - "Template renders comma-separated values as individual links"
  artifacts:
    - path: "resources/extension-config.json"
      provides: "Property/Page template definition in templates section"
      contains: "Property/Page"
  key_links:
    - from: "resources/extension-config.json"
      to: "ExtensionConfigInstaller"
      via: "Layer 0 templates array"
      pattern: "templates.*Property/Page"
---

<objective>
Add Template:Property/Page to extension configuration to render Page-type property values as clickable wiki links.

Purpose: Enable Page-type properties to display as navigable wiki links instead of plain text, completing the foundation for Phase 2's smart template selection.

Output: Updated extension-config.json with Property/Page template entry that handles single values, multiple comma-separated values, and empty values correctly.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-template-foundation/01-RESEARCH.md
@resources/extension-config.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Property/Page template to extension-config.json</name>
  <files>resources/extension-config.json</files>
  <action>
Add new template entry to the "templates" section of extension-config.json, following the existing pattern used by Property/Default, Property/Email, and Property/Link.

Add this entry after "Property/Link" (inside the templates object):

```json
"Property/Page": {
  "content": "<includeonly>{{#if:{{{value|}}}|{{#arraymap:{{{value|}}}|,|@@item@@|[[@@item@@]]|, }}|}}</includeonly>",
  "description": "Displays Page-type property values as clickable wiki links"
}
```

CRITICAL: Use `@@item@@` as the #arraymap variable (NOT `x` or `xx`). The `x` variable causes text substitution bugs in property names containing "x" (e.g., "Data export" becomes "Data eort").

The template works as follows:
- `{{#if:{{{value|}}}|...|}}` - Only output if value is non-empty (REQ-003)
- `{{#arraymap:{{{value|}}}|,|@@item@@|[[@@item@@]]|, }}` - Split on comma, wrap each item in [[wikilink]], rejoin with ", "
- `<includeonly>` wrapper - Standard for all property display templates

Ensure JSON remains valid after edit.
  </action>
  <verify>
Run: `python3 -c "import json; json.load(open('resources/extension-config.json'))"`
Should exit 0 with no output (valid JSON).

Run: `grep -A2 '"Property/Page"' resources/extension-config.json`
Should show the new template entry with content and description fields.
  </verify>
  <done>
- extension-config.json contains Property/Page template entry
- Template content uses `@@item@@` variable
- Template content includes `#if` wrapper for empty values
- Template content includes `#arraymap` for multi-value support
- JSON is valid
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify template functionality in Docker test environment</name>
  <files></files>
  <action>
Verify the template works correctly by testing in the Docker wiki environment.

1. Start Docker environment if not running:
   ```bash
   docker compose up -d
   ```

2. Wait for wiki to be ready (check logs or HTTP response)

3. Install/reinstall extension config to create the new template:
   ```bash
   docker compose exec wiki php maintenance/run.php /var/www/html/extensions/SemanticSchemas/maintenance/installConfig.php
   ```

4. Verify template was created by checking wiki API:
   ```bash
   curl -s "http://localhost:8889/api.php?action=query&titles=Template:Property/Page&prop=revisions&rvprop=content&format=json"
   ```
   Response should include the template content with #arraymap and [[@@item@@]].

5. Test template behavior directly by previewing wikitext. Use the API to parse wikitext:

   Test empty value (should produce nothing):
   ```bash
   curl -s "http://localhost:8889/api.php?action=parse&text={{Property/Page|value=}}&contentmodel=wikitext&format=json" | python3 -c "import sys,json; print(json.load(sys.stdin)['parse']['text']['*'])"
   ```
   Expected: Empty or just whitespace in output.

   Test single value:
   ```bash
   curl -s "http://localhost:8889/api.php?action=parse&text={{Property/Page|value=Person}}&contentmodel=wikitext&format=json" | python3 -c "import sys,json; print(json.load(sys.stdin)['parse']['text']['*'])"
   ```
   Expected: Contains `<a href=` link to Person page.

   Test multiple values:
   ```bash
   curl -s "http://localhost:8889/api.php?action=parse&text={{Property/Page|value=Person, Place, Thing}}&contentmodel=wikitext&format=json" | python3 -c "import sys,json; print(json.load(sys.stdin)['parse']['text']['*'])"
   ```
   Expected: Contains three separate `<a href=` links.

Note: If Docker environment is not available or not working, document the issue and skip to manual verification instructions. The template definition itself is the primary deliverable; runtime verification confirms correct behavior but config correctness can be verified by JSON validation and content inspection.
  </action>
  <verify>
The following conditions indicate success:
1. `docker compose ps` shows wiki container running (or skip if Docker unavailable)
2. Template:Property/Page exists in wiki (API query returns content)
3. Empty value test produces no visible links
4. Single value test produces one link
5. Multiple value test produces multiple links separated by commas

If Docker is unavailable:
- JSON validation passed (Task 1)
- Template content inspection shows correct pattern
- Document that runtime testing should be done before Phase 2
  </verify>
  <done>
- Template:Property/Page installed in wiki (or documented as pending if Docker unavailable)
- Empty value handling verified (produces nothing)
- Single value handling verified (produces one link)
- Multi-value handling verified (produces comma-separated links)
- No #arraymap variable collision issues observed
  </done>
</task>

</tasks>

<verification>
Phase 1 success criteria from ROADMAP:

1. Template:Property/Page is defined in extension-config.json Layer 0 - Check templates section
2. Template handles empty/missing values by producing no output - Test with `value=`
3. Template renders single value as clickable wiki link - Test with `value=Person`
4. Template renders comma-separated values as individual links joined by ", " - Test with `value=A, B, C`
5. Template uses `@@item@@` variable (not `x`) to avoid name collision - Inspect template content

Commands:
```bash
# Verify JSON validity
python3 -c "import json; json.load(open('resources/extension-config.json'))"

# Verify template exists in config
grep -q '"Property/Page"' resources/extension-config.json && echo "Template defined"

# Verify uses @@item@@ not x
grep -q '@@item@@' resources/extension-config.json && echo "Uses safe variable"
```
</verification>

<success_criteria>
- resources/extension-config.json contains Property/Page template entry
- Template content is exactly: `<includeonly>{{#if:{{{value|}}}|{{#arraymap:{{{value|}}}|,|@@item@@|[[@@item@@]]|, }}|}}</includeonly>`
- JSON is valid (no syntax errors)
- Template renders correctly when installed (or documented for later verification)
- REQ-003 (empty value handling) satisfied
- REQ-005 (Template:Property/Page implementation) satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/01-template-foundation/01-01-SUMMARY.md`
</output>
